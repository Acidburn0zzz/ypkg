actions:
    - configure: |
        ./configure %CONFOPTS%
    - reconfigure: |
        autoreconf -vfi
        %configure
    - autogen: |
        ./autogen.sh %CONFOPTS%
        %configure
    - make: |
        make %JOBS%
    - make_install: |
        %make install DESTDIR="%installroot%"
    - cmake: |
        cmake -DCMAKE_CFLAGS="%CFLAGS%" -DCMAKE_CXX_FLAGS="%CXXFLAGS%" \
        -DCMAKE_LD_FLAGS="%LDFLAGS%" -DCMAKE_LIB_SUFFIX="%LIBSUFFIX%" \
        -DCMAKE_BUILD_TYPE=RelWithDebInfo
    - patch: |
        patch -t -E --no-backup-if-mismatch -f
    # Only works if the user has a series file.
    - apply_patches: |
        test -e "$pkgfiles/series" || exit 1
        while read -r pname ; do
            if [[ "$pname" == "" ]]; then
                continue
            fi
            %patch -p1 -i $pkgfiles/$pname
        done < $pkgfiles/series
    # Inspired by the RPM guys :]
    - perl_privlib: |
        $(eval `perl -V:installprivlib`; echo $installprivlib)
    # Make life easier with Perl
    - perl_setup: |
        function perl_setup() {
            if [[ -e Build.PL ]]; then
                perl Build.PL installdirs=vendor create_packlist=0 $* || exit 1
            else
                perl Makefile.PL PREFIX=/usr INSTALLDIRS=vendor DESTDIR="%installroot%" $* || exit 
            fi
        }
        perl_setup
    - perl_build: |
        function perl_build() {
            if [[ -e Build.PL ]]; then
                perl Build installdirs=vendor create_packlist=0 $* || exit 1
            else
                %make $* || exit 1
            fi
        }
        perl_build
    # We need to nuke use of privlib because its always a perllocal.pod situation,
    # and these macros explicitly use vendor libs
    - perl_install: |
        function perl_install() {
            if [[ -e Build.PL ]]; then
                perl Build destdir="%installroot%" install $* || exit 1
            else
                %make_install $* || exit 1
            fi
            priv_lib="%perl_privlib"
            if [[ -e "$installdir/$priv_lib" ]]; then
                rm -rfv "$installdir/$priv_lib"
            fi
        }
        perl_install
defines:
    - CONFOPTS: |
        --prefix=%PREFIX% --build=%HOST% --libdir=%libdir% --mandir=/usr/share/man \
        --infodir=/usr/share/info --datadir=/usr/share --sysconfdir=/etc \
        --localstatedir=/var --libexecdir=%libdir%/%PKGNAME%
